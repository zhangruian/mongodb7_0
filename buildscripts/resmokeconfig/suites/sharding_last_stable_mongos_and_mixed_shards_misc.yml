# This file was generated by buildscripts/generate_resmoke_suites.py and manual edits should also be
# made to sharding_last_stable_mongos_and_mixed_shards.yml in order to ensure running the full test
# suite locally matches the behavior of running parts of the test suite in Evergreen. It was
# generated against commit range:
#   2e31167d0e2cf179a228afeec71853cfb0f0683f - 7f256590c7f0bc847612a1d5a0ef6bcfb10c379b
# with the following options:
#   Namespace(branch='master', duration_days=14, end_commit=None, execution_time_minutes=20, owner='mongodb', project='mongo', start_commit=None, task=['sharding_last_stable_mongos_and_mixed_shards'], variants='linux-64-debug,enterprise-rhel-62-64-bit,enterprise-windows-64-2k8', verbose=True)

test_kind: js_test

selector:
  roots:
  - jstests/sharding/*.js
  exclude_files:
  # Will always fail on last-stable. In order for the test to succeed, the setFCV
  # command has to reach the shards. Since the cluster will already be
  # running in fully downgraded version, the config server won't forward the
  # command to the shards - it'll just return success immediately.
  - jstests/sharding/max_time_ms_sharded_new_commands.js
  # Requires fix to SERVER-31689
  - jstests/sharding/aggregation_currentop.js
  # SERVER-33683: We added a restriction on using an aggregation within a transaction against
  # mongos. This should be removed and the test can be adjusted and re-added to this passthrough.
  - jstests/sharding/aggregations_in_session.js
  # New waitForClusterTime
  - jstests/sharding/auth_slaveok_routing.js
  # This test should not be run with a mixed cluster environment.
  - jstests/sharding/nonreplicated_uuids_on_shardservers.js
  # Disabled throughout sharding. See SERVER-31937 for details.
  - jstests/sharding/kill_sessions.js
  - jstests/sharding/mongos_rs_shard_failure_tolerance.js
  - jstests/sharding/mongos_rs_auth_shard_failure_tolerance.js
  - jstests/sharding/zbigMapReduce.js
  - jstests/sharding/remove2.js
  - jstests/sharding/top_chunk_autosplit.js
  - jstests/sharding/move_chunk_find_and_modify_with_write_retryability.js
  - jstests/sharding/batch_write_command_sharded.js
  - jstests/sharding/config_rs_no_primary.js
  - jstests/sharding/shard_config_db_collections.js
  - jstests/sharding/read_pref.js
  - jstests/sharding/read_pref_cmd.js
  - jstests/sharding/rs_stepdown_and_pooling.js
  - jstests/sharding/primary_config_server_blackholed_from_mongos.js
  - jstests/sharding/enforce_zone_policy.js
  - jstests/sharding/mr_and_agg_versioning.js
  - jstests/sharding/sharding_balance3.js
  - jstests/sharding/startup_with_all_configs_down.js
  - jstests/sharding/all_shard_and_config_hosts_brought_down_one_by_one.js
  - jstests/sharding/mongos_no_replica_set_refresh.js
  - jstests/sharding/repl_monitor_refresh.js
  - jstests/sharding/auth.js
  - jstests/sharding/shard_kill_and_pooling.js
  - jstests/sharding/bulk_shard_insert.js
  - jstests/sharding/sharding_balance4.js
  - jstests/sharding/convert_to_and_from_sharded.js
  - jstests/sharding/shard_identity_config_update.js
  - jstests/sharding/rename.js
  - jstests/sharding/index_and_collection_option_propagation.js
  - jstests/sharding/count_slaveok.js
  - jstests/sharding/sharding_rs1.js
  - jstests/sharding/all_config_servers_blackholed_from_mongos.js
  - jstests/sharding/mongos_shard_failure_tolerance.js
  - jstests/sharding/addshard4.js
  - jstests/sharding/recovering_slaveok.js
  - jstests/sharding/jumbo1.js
  - jstests/sharding/sharding_rs2.js
  - jstests/sharding/addshard2.js
  - jstests/sharding/auto_rebalance_parallel_replica_sets.js
  - jstests/sharding/move_chunk_insert_with_write_retryability.js
  - jstests/sharding/replmonitor_bad_seed.js
  - jstests/sharding/move_chunk_remove_with_write_retryability.js
  - jstests/sharding/move_chunk_update_with_write_retryability.js
  - jstests/sharding/drop_sharded_db.js
  - jstests/sharding/key_rotation.js
  - jstests/sharding/sharding_balance1.js
  - jstests/sharding/shard_identity_rollback.js
  - jstests/sharding/commands_that_write_accept_wc_shards.js
  - jstests/sharding/query_after_multi_write.js
  - jstests/sharding/find_and_modify_after_multi_write.js
  - jstests/sharding/sharding_multiple_ns_rs.js
  - jstests/sharding/shard_aware_init.js
  - jstests/sharding/balance_repl.js
  - jstests/sharding/authCommands.js
  - jstests/sharding/test_stacked_migration_cleanup.js
  - jstests/sharding/shard_aware_primary_failover.js
  - jstests/sharding/sharding_migrate_cursor1.js
  - jstests/sharding/mongod_returns_no_cluster_time_without_keys.js
  - jstests/sharding/delete_during_migrate.js
  - jstests/sharding/change_stream_chunk_migration.js
  - jstests/sharding/parallel.js
  - jstests/sharding/diffservers1.js
  - jstests/sharding/mongos_does_not_gossip_logical_time_without_keys.js
  - jstests/sharding/shard_existing_coll_chunk_count.js
  - jstests/sharding/explain_read_pref.js
  - jstests/sharding/auto_rebalance_parallel.js
  - jstests/sharding/bouncing_count.js
  - jstests/sharding/balancer_window.js
  - jstests/sharding/shard_insert_getlasterror_w2.js
  - jstests/sharding/read_pref_multi_mongos_stale_config.js
  - jstests/sharding/write_commands_sharding_state.js
  - jstests/sharding/names.js
  - jstests/sharding/change_stream_enforce_max_time_ms_on_mongos.js
  - jstests/sharding/shard_collection_basic.js
  - jstests/sharding/autosplit_with_balancer.js
  - jstests/sharding/migrateBig.js
  - jstests/sharding/migrateBig_balancer.js
  - jstests/sharding/mapReduce_inSharded.js
  - jstests/sharding/cursor_valid_after_shard_stepdown.js
  - jstests/sharding/movechunk_parallel.js
  - jstests/sharding/read_committed_lookup.js
  - jstests/sharding/mr_shard_version.js
  - jstests/sharding/key_many.js
  - jstests/sharding/autosplit_heuristics.js
  - jstests/sharding/lagged_config_secondary.js
  - jstests/sharding/cleanup_orphaned_basic.js
  - jstests/sharding/unowned_doc_filtering.js
  - jstests/sharding/basic_sharding_params.js
  - jstests/sharding/shard_aware_init_secondaries.js
  - jstests/sharding/mapReduce_inSharded_outSharded.js
  - jstests/sharding/large_chunk.js
  - jstests/sharding/migration_move_chunk_after_receive.js
  - jstests/sharding/linearizable_read_concern.js
  - jstests/sharding/migration_id_index.js
  - jstests/sharding/explain_agg_read_pref.js
  - jstests/sharding/session_info_in_oplog.js
  - jstests/sharding/secondary_shard_version_protocol_with_causal_consistency.js
  - jstests/sharding/retryable_writes.js
  - jstests/sharding/view_rewrite.js
  - jstests/sharding/hash_shard1.js
  - jstests/sharding/split_with_force.js
  - jstests/sharding/secondary_shard_versioning.js
  - jstests/sharding/coll_epoch_test1.js
  - jstests/sharding/change_streams_shards_start_in_sync.js
  - jstests/sharding/migration_ignore_interrupts_1.js
  - jstests/sharding/migration_ignore_interrupts_3.js
  - jstests/sharding/change_streams_establishment_finds_new_shards.js
  - jstests/sharding/migration_ignore_interrupts_4.js
  - jstests/sharding/in_memory_sort_limit.js
  - jstests/sharding/zero_shard_version.js
  - jstests/sharding/remove1.js
  - jstests/sharding/multi_write_target.js
  - jstests/sharding/array_shard_key.js
  - jstests/sharding/validate_collection.js
  - jstests/sharding/move_chunk_wc.js
  - jstests/sharding/cursor_timeout.js
  - jstests/sharding/hash_basic.js
  - jstests/sharding/cursor1.js
  - jstests/sharding/mapReduce_nonSharded.js
  - jstests/sharding/hash_shard_num_chunks.js
  - jstests/sharding/coll_epoch_test2.js
  - jstests/sharding/tag_auto_split.js
  - jstests/sharding/sharding_balance2.js
  - jstests/sharding/addshard_idempotent.js
  - jstests/sharding/tag_auto_split_partial_key.js
  - jstests/sharding/shard3.js
  - jstests/sharding/after_cluster_time.js
  - jstests/sharding/multi_coll_drop.js
  - jstests/sharding/merge_chunks_test.js
  - jstests/sharding/write_cmd_auto_split.js
  - jstests/sharding/index1.js
  - jstests/sharding/features2.js
  - jstests/sharding/hash_shard_non_empty.js
  - jstests/sharding/sort1.js
  - jstests/sharding/addshard5.js
  - jstests/sharding/count2.js
  - jstests/sharding/features1.js
  - jstests/sharding/regex_targeting.js
  - jstests/sharding/shard6.js
  - jstests/sharding/query_config.js
  - jstests/sharding/movechunk_interrupt_at_primary_stepdown.js
  - jstests/sharding/basic_split.js
  - jstests/sharding/cleanup_orphaned_cmd_during_movechunk.js
  - jstests/sharding/pending_chunk.js
  - jstests/sharding/migration_sets_fromMigrate_flag.js
  - jstests/sharding/basic_merge.js
  - jstests/sharding/move_chunk_basic.js
  - jstests/sharding/write_transactions_during_migration.js
  - jstests/sharding/migration_critical_section_concurrency.js
  - jstests/sharding/multi_mongos2.js
  - jstests/sharding/explain_cmd.js
  - jstests/sharding/move_chunk_open_cursors.js
  - jstests/sharding/time_zone_info_mongos.js
  - jstests/sharding/agg_sort.js
  - jstests/sharding/error_during_agg_getmore.js
  - jstests/sharding/cleanup_orphaned.js
  - jstests/sharding/remove3.js
  - jstests/sharding/cleanup_orphaned_cmd_during_movechunk_hashed.js
  - jstests/sharding/cleanup_orphaned_compound.js
  - jstests/sharding/no_empty_reset.js
  - jstests/sharding/features3.js
  - jstests/sharding/merge_chunks_test_with_md_ops.js
  - jstests/sharding/cleanup_orphaned_cmd_prereload.js
  - jstests/sharding/uuid_propagated_to_recipient_shard_on_recvChunkStart.js
  - jstests/sharding/operation_time_api.js
  - jstests/sharding/logical_time_metadata.js
  - jstests/sharding/migration_ignore_interrupts_2.js
  - jstests/sharding/shard4.js
  - jstests/sharding/shard_with_special_db_names.js
  - jstests/sharding/migration_with_source_ops.js
  - jstests/sharding/shard5.js
  - jstests/sharding/uuid_propagated_to_config_server_on_shardCollection.js
  - jstests/sharding/trace_missing_docs_test.js
  - jstests/sharding/enable_sharding_basic.js
  - jstests/sharding/noUpdateButN1inAnotherCollection.js
  - jstests/sharding/stats.js
  - jstests/sharding/views.js
  - jstests/sharding/migration_failure.js
  - jstests/sharding/shard_targeting.js
  - jstests/sharding/listshards.js
  - jstests/sharding/multi_mongos2a.js
  - jstests/sharding/logical_time_api.js
  - jstests/sharding/error_propagation.js
  - jstests/sharding/findandmodify2.js
  - jstests/sharding/cleanup_orphaned_cmd_hashed.js
  - jstests/sharding/moveChunk_recipient_rejects_chunk_if_UUID_mismatch.js
  - jstests/sharding/inserts_consistent.js
  - jstests/sharding/upsert_sharded.js
  - jstests/sharding/shard2.js
  - jstests/sharding/split_stale_mongos.js
  - jstests/sharding/shard_aware_on_add_shard.js
  - jstests/sharding/migration_server_status.js
  - jstests/sharding/agg_project_limit_pipe_split.js
  - jstests/sharding/movechunk_with_moveParanoia.js
  - jstests/sharding/movechunk_with_default_paranoia.js
  - jstests/sharding/shard_key_immutable.js
  - jstests/sharding/sharding_system_namespaces.js
  - jstests/sharding/min_optime_recovery_on_successful_move_chunk_commit.js
  - jstests/sharding/movechunk_with_noMoveParanoia.js
  - jstests/sharding/count1.js
  - jstests/sharding/move_chunk_missing_idx.js
  - jstests/sharding/causal_consistency_shell_support.js
  - jstests/sharding/shard_existing.js
  - jstests/sharding/cursor_cleanup.js
  - jstests/sharding/mr_noscripting.js
  - jstests/sharding/mapReduce_outSharded.js
  - jstests/sharding/limit_push.js
  - jstests/sharding/autosplit.js
  - jstests/sharding/exact_shard_key_target.js
  - jstests/sharding/sharded_limit_batchsize.js
  - jstests/sharding/arbiters_do_not_use_cluster_time.js
  - jstests/sharding/migrate_overwrite_id.js
  - jstests/sharding/key_string.js
  - jstests/sharding/shard_collection_verify_initial_chunks.js
  - jstests/sharding/merge_chunks_compound_shard_key.js
  - jstests/sharding/use_rsm_data_for_cs.js
  - jstests/sharding/fts_score_sort_sharded.js
  - jstests/sharding/idhack_sharded.js
  - jstests/sharding/presplit.js
  - jstests/sharding/move_stale_mongos.js
  - jstests/sharding/implicit_db_creation.js
  - jstests/sharding/auth_add_shard.js
  - jstests/sharding/min_optime_recovery_on_failed_move_chunk_commit.js
  - jstests/sharding/not_allowed_on_sharded_collection_cmd.js
  - jstests/sharding/find_getmore_cmd.js
  - jstests/sharding/explain_find_and_modify_sharded.js
  - jstests/sharding/large_skip_one_shard.js
  - jstests/sharding/empty_doc_results.js
  - jstests/sharding/findandmodify1.js
  - jstests/sharding/shard_keycount.js
  - jstests/sharding/refresh_sessions.js
  - jstests/sharding/update_immutable_fields.js
  - jstests/sharding/drop_configdb.js
  - jstests/sharding/shard1.js
  - jstests/sharding/SERVER-7379.js
  - jstests/sharding/localhostAuthBypass.js
  - jstests/sharding/create_idx_empty_primary.js
  - jstests/sharding/clone_catalog_data.js
  - jstests/sharding/coll_epoch_test0.js
  - jstests/sharding/initial_split_validate_shard_collections.js
  - jstests/sharding/conn_pool_stats.js
  - jstests/sharding/tag_range.js
  - jstests/sharding/replication_with_undefined_shard_key.js
  - jstests/sharding/prefix_shard_key.js
  - jstests/sharding/keys_rotation_interval_sec.js
  - jstests/sharding/addshard1.js
  - jstests/sharding/bulk_insert.js
  - jstests/sharding/mrShardedOutput.js
  - jstests/sharding/authConnectionHook.js
  - jstests/sharding/oplog_document_key.js
  - jstests/sharding/top_chunk_split.js
  - jstests/sharding/split_large_key.js
  - jstests/sharding/mongos_validate_writes.js
  - jstests/sharding/mongos_no_detect_sharding.js
  - jstests/sharding/major_version_check.js
  - jstests/sharding/stale_version_write.js
  - jstests/sharding/advance_logical_time_with_valid_signature.js
  - jstests/sharding/rename_across_mongos.js
  - jstests/sharding/sharded_profile.js
  - jstests/sharding/return_partial_shards_down.js
  - jstests/sharding/covered_shard_key_indexes.js
  - jstests/sharding/map_reduce_validation.js
  - jstests/sharding/hash_single_shard.js
  - jstests/sharding/version1.js
  - jstests/sharding/sessions_collection_auto_healing.js
  - jstests/sharding/update_zone_key_range.js
  - jstests/sharding/hash_shard_unique_compound.js
  - jstests/sharding/disable_autosplit.js
  - jstests/sharding/mongos_query_comment.js
  - jstests/sharding/read_after_optime.js
  - jstests/sharding/server_status.js
  - jstests/sharding/missing_key.js
  - jstests/sharding/listDatabases.js
  - jstests/sharding/split_against_shard_with_invalid_split_points.js
  - jstests/sharding/split_with_force_small.js
  - jstests/sharding/ssv_config_check.js
  - jstests/sharding/version2.js
  - jstests/sharding/query_sharded.js
  - jstests/sharding/kill_op_overflow.js
  - jstests/sharding/auth2.js
  - jstests/sharding/add_shard_to_zone.js
  - jstests/sharding/allow_partial_results.js
  - jstests/sharding/cleanup_orphaned_auth.js
  - jstests/sharding/ismaster.js
  - jstests/sharding/balancer_shell_commands.js
  - jstests/sharding/read_does_not_create_namespaces.js
  - jstests/sharding/remove_shard_from_zone.js
  - jstests/sharding/addshard6.js
  - jstests/sharding/autodiscover_config_rs_from_secondary.js
  - jstests/sharding/mrShardedOutputAuth.js
  - jstests/sharding/authmr.js
  - jstests/sharding/forget_mr_temp_ns.js
  - jstests/sharding/auth_sharding_cmd_metadata.js
  - jstests/sharding/authwhere.js
  - jstests/sharding/auth_no_config_primary.js
  - jstests/sharding/json_schema.js
  - jstests/sharding/printShardingStatus.js
  - jstests/sharding/empty_cluster_init.js
  - jstests/sharding/count_config_servers.js
  - jstests/sharding/auth_repl.js
  - jstests/sharding/sharding_options.js
  - jstests/sharding/advance_cluster_time_action_type.js
  - jstests/sharding/config_rs_change.js
  - jstests/sharding/current_op_no_shards.js
  - jstests/sharding/move_chunk_with_session_helper.js
  - jstests/sharding/movechunk_include.js
  # Enable when SERVER-33538 is backported.
  - jstests/sharding/mapReduce_outSharded_checkUUID.js
  # Will always fail because we can't downgrade FCV before the last-stable binary mongos connects,
  # meaning that either the test will stall, or mongos will crash due to connecting to an upgraded
  # FCV cluster.
  - jstests/sharding/mongos_wait_csrs_initiate.js
  # Enable if SERVER-34971 is backported or 4.2 becomes last-stable
  - jstests/sharding/update_replace_id.js
  - jstests/sharding/stale_mongos_updates_and_removes.js
  - jstests/sharding/geo_near_sharded.js
  # Enable when 4.2 becomes last-stable.
  - jstests/sharding/collation_targeting.js
  - jstests/sharding/collation_targeting_inherited.js
  - jstests/sharding/geo_near_random1.js
  - jstests/sharding/geo_near_random2.js
  - jstests/sharding/out_with_chunk_migrations.js
  - jstests/sharding/out_from_stale_mongos.js
  - jstests/sharding/out_to_existing.js
  - jstests/sharding/out_to_non_existing.js
  - jstests/sharding/out_unique_key.js
  - jstests/sharding/restart_transactions.js
  - jstests/sharding/shard7.js
  - jstests/sharding/shard_collection_existing_zones.js
  - jstests/sharding/snapshot_cursor_commands_mongos.js
  - jstests/sharding/transactions_snapshot_errors_first_statement.js
  - jstests/sharding/transactions_snapshot_errors_subsequent_statements.js
  - jstests/sharding/transactions_stale_database_version_errors.js
  - jstests/sharding/transactions_stale_shard_version_errors.js
  - jstests/sharding/txn_agg.js
  - jstests/sharding/txn_basic_two_phase_commit.js
  - jstests/sharding/txn_coordinator_commands_basic_requirements.js
  - jstests/sharding/update_sharded.js
  # Enable if SERVER-20865 is backported or 4.2 becomes last-stable
  - jstests/sharding/sharding_statistics_server_status.js

executor:
  config:
    shell_options:
      global_vars:
        TestData:
          mongosBinVersion: 'last-stable'
          shardMixedBinVersions: true
          skipCheckingUUIDsConsistentAcrossCluster: true
      nodb: ''
