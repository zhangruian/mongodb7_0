variables:
- &amazon2_x86_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: amazon2-x86-compile

- &amazon_linux2_arm64_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: amazon2-arm64-compile

- &al2023_al2_arm64_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: al2023-arm64-compile
  - name: package_new_compile
    variant: amazon2-arm64-compile

- &amazon_linux2_arm64_mongocrypt_compile_variant_dependency
  depends_on:
  - name: package_new_compile
    variant: amazon2-arm64-compile
  - name: compile_mongocrypt_shlib
    variant: compile-amazon-linux2-arm64-mongocrypt-shlib

- &schedule_variant_auto_tasks_task
  name: schedule_variant_auto_tasks
  activate: false
  depends_on:
    - name: schedule_global_auto_tasks
      variant: task_generation

- &schedule_patch_auto_tasks_task
  name: schedule_patch_auto_tasks
  activate: false
  depends_on:
    - name: schedule_global_auto_tasks
      variant: task_generation

- modules: &perf_modules
    - dsi
    - genny
    - workloads
    - linkbench
    - linkbench2
    - tsbs
    - mongo-perf
    - YCSB
    - PrivateWorkloads
    - py-tpcc
    - flamegraph

buildvariants:
- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-atlas-M60-real.arm.aws.2023-11
  display_name: PERF M60-Atlas ReplSet ARM AWS 2023-11
  cron: "0 0 * * 0,4"  # 00:00 on Sunday, Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: atlas
    canaries: none
    atlas_setup: M60-repl
    use_custom_build: true
    infrastructure_provisioning: workload_client_arm.2023-04
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: &perf_project_dir dsi
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-atlas-large"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: tpcc
    - name: tpcc_majority
    - name: linkbench
    - name: linkbench2

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-atlas-M60-real.intel.azure.2023-11
  display_name: PERF M60-Atlas ReplSet Intel Azure 2023-11
  cron: "0 0 * * 0,4"  # 00:00 on Sunday, Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: atlas
    canaries: none
    atlas_setup: M60-repl-azure
    use_custom_build_azure: true
    compile_variant: amazon2-x86-compile
    infrastructure_provisioning: workload_client_intel.2023-11
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    storageEngine: wiredTiger
  run_on:
    - "rhel70-perf-atlas-large"
  tasks: # Cannot use *3nodetasks because secondary_performance uses a special mongodb setup
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: tpcc
    - name: tpcc_majority
    - name: linkbench
    - name: linkbench2

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-shard.arm.aws.2023-11
  display_name: PERF 3-Shard Cluster ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-shard"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_w1.2023-09
    - name: crud_workloads_majority
    - name: crud_workloads_w1
    - name: misc_workloads
    - name: map_reduce_workloads
    - name: smoke_test
    - name: mongos_workloads
    - name: mongos_large_catalog_workloads
    - name: move_chunk_workloads
    - name: change_streams_latency
    - name: change_streams_listen_throughput
    - name: change_streams_multi_mongos
    - name: tsbs_query_sharded
    - name: tsbs_query_finance_sharded
    - name: tsbs_query_sharded_balancer
    - name: tsbs_query_finance_sharded_balancer

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet ARM AWS 2023-11
  cron: "0 0 * * 1,2,3,4,5,6"  # Everyday except Sunday at 00:00
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_w1.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb.load
    - name: ycsb_60GB.long.2023-09
    - name: ycsb_secondary_reads.2023-09
    - name: crud_workloads_majority
    - name: crud_workloads_w1
    - name: misc_workloads
    - name: map_reduce_workloads
    - name: refine_shard_key_transaction_stress
    - name: smoke_test
    - name: secondary_performance # Uses a special 2 node mongodb setup
    - name: non_sharded_workloads
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_query
    - name: change_streams_preimage_throughput
    - name: change_streams_latency
    - name: change_streams_preimage_latency
    - name: change_streams_listen_throughput
    - name: snapshot_reads
    - name: secondary_reads
    - name: tpcc
    - name: tpcc_majority
    - name: tpch_1_normalized
    - name: tpch_1_denormalized
    # TODO: Enable in SERVER-66572.
    # - name: tpch_10_normalized
    # - name: tpch_10_denormalized
    - name: linkbench
    - name: linkbench2
    - name: tsbs_load
    - name: tsbs_query
    - name: tsbs_query_finance
    - name: tsbs_query_manual_bucketing
    - name: tsbs-query-genny
    - name: tsbs-query-optimizations
    - name: tsbs-expression-query
    - name: big_update_10k
    - name: mixed_workloads_genny_rate_limited_high_value
    - name: load_test_high_value
    - name: majority_reads10_k_threads_high_value
    - name: large_indexed_ins_high_value
    - name: expressive_queries_high_value
    - name: time_series_sort_high_value

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-3-node-replSet-intel.intel.aws.2023-11
  display_name: PERF 3-Node ReplSet Intel AWS 2023-11
  cron: "0 0 * * 1,2,3,4,5,6"  # Everyday except Sunday at 00:00
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: crud_workloads_majority
    - name: smoke_test
    - name: linkbench
    - name: linkbench2
    - name: mixed_workloads_genny_rate_limited_high_value
    - name: tsbs-expression-query
    # Tasks added for QueryStats comparison
    - name: ycsb_60GB.long.2023-09
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_query
    - name: tpcc_majority
    - name: tsbs_load
    - name: tsbs_query

# On PERF-730 we changed the initial sync tests to use two nodes instead of three. To avoid
# losing history, the name remains unchanged, but the display_name reflects the change to 2-Node.
- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-2-node-replSet-initialsync.arm.aws.2023-11
  display_name: PERF 2-Node ReplSet Initial Sync ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-2node
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica-2node
    workload_setup: 2022-11
    platform: linux
    authentication: disabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
    project_dir: *perf_project_dir
  run_on:
    - "rhel70-perf-replset"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: initialsync-large
    - name: initialsync-large-fcbis

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-standalone.arm.aws.2023-11
  display_name: PERF Standalone ARM AWS 2023-11
  cron: &linux-standalone-cron "0 0 * * 2,4,6"  # Tuesday, Thursday and Saturday at 00:00
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-single"
  tasks: &standalonetasks
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: array_traversal_high_value
    - name: filter_with_complex_logical_expression_high_value
    # Tasks added for QueryStats comparison
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: crud_workloads_majority
    - name: tpcc
    - name: tpch_1_normalized
    - name: tpch_1_denormalized
    - name: tpch_10_normalized
    - name: tpch_10_denormalized

- <<: *amazon_linux2_arm64_mongocrypt_compile_variant_dependency
  name: perf-shard-lite-fle.arm.aws.2023-11
  display_name: PERF Shard Lite FLE ARM AWS 2023-11
  cron: "0 0 * * 0,4"  # 00:00 on Sunday,Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-lite-fle
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard-lite
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
    requires_mongocrypt_shlib: true
  run_on:
    - "rhel70-perf-shard-lite"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: medical_workload_diagnosis_50_50_high_value
    - name: ycsb_like_queryable_encrypt1_cfdefault_high_value

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-mongo-perf-standalone.arm.aws.2023-11
  display_name: PERF Mongo-Perf Standalone inMemory ARM AWS 2023-11
  cron: &linux-microbench-cron "0 0 * * *"  # Everyday at 00:00
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-standalone.2023-02
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined.2023-01
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-arm64-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks:
    - name: big_collection
    - name: genny_scale_InsertRemove
    - name: genny_execution_UserAcquisition
    - name: aggregation_read_commands
    - name: aggregation_read_commands_large_dataset
    - name: agg-query-comparison_read_commands
    - name: query_read_commands
    - name: query_read_commands_large_dataset
    - name: views-aggregation
    - name: views-query
    - name: where_read_commands
    - name: update_read_commands
    - name: insert_read_commands
    - name: wildcard-index-read_read_commands
    - name: wildcard-index-write_read_commands
    - name: geo_read_commands
    - name: misc_read_commands
    - name: misc_custom_filter_default_read_commands
    - name: misc_custom_filter_slow_or_sample_read_commands
    - name: misc_custom_filter_complex_read_commands
    - name: misc_custom_filter_whole_doc_read_commands
    - name: misc_slowms_everything_read_commands
    - name: singleThreaded_read_commands
    - name: pipeline-updates
    - name: javascript
    - name: compound_wildcard_index_write_commands
    - name: compound_wildcard_index_read_commands
    # Task added for QueryStats comparison
    - name: tie-breaking-heuristics

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-mongo-perf-standalone.intel.aws.2023-11
  display_name: PERF Mongo-Perf Standalone inMemory Intel AWS 2023-11
  cron: *linux-microbench-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-standalone.2023-02
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined_intel.2023-11
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-x86-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks:
  - name: big_collection
  - name: genny_scale_InsertRemove
  - name: genny_execution_UserAcquisition
  - name: aggregation_read_commands
  - name: aggregation_read_commands_large_dataset
  - name: agg-query-comparison_read_commands
  - name: query_read_commands
  - name: query_read_commands_large_dataset
  - name: views-aggregation
  - name: views-query
  - name: where_read_commands
  - name: update_read_commands
  - name: insert_read_commands
  - name: wildcard-index-read_read_commands
  - name: wildcard-index-write_read_commands
  - name: geo_read_commands
  - name: misc_read_commands
  - name: misc_custom_filter_default_read_commands
  - name: misc_custom_filter_slow_or_sample_read_commands
  - name: misc_custom_filter_complex_read_commands
  - name: misc_custom_filter_whole_doc_read_commands
  - name: misc_slowms_everything_read_commands
  - name: singleThreaded_read_commands
  - name: pipeline-updates
  - name: javascript
  - name: compound_wildcard_index_write_commands
  - name: compound_wildcard_index_read_commands

# Added as baseline comparison for QueryStats, as doing custom configuration on real Atlas proved to
# be difficult.
- <<: *al2023_al2_arm64_compile_variant_dependency
  name: atlas-like-replica.2023-09
  display_name: PERF M60-like 3-Node ReplSet 2023-09
  cron: &atlas-like-repl-cron "0 0 * * 0,4"  # 00:00 on Sunday,Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup: atlas-like-replica.2023-09
    mongodb_setup_release: 2022-11
    infrastructure_provisioning: M60-like-replica.2023-09
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: al2023-arm64-compile
    client_compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-M60-like"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: tpcc
    - name: tpcc_majority
    - name: linkbench
    - name: linkbench2

######################## QueryStats variants ########################
- <<: *al2023_al2_arm64_compile_variant_dependency
  name: atlas-like-replica-query-stats.2023-09
  display_name: PERF M60-like 3-Node ReplSet (QueryStats) 2023-09
  cron: *atlas-like-repl-cron
  modules: *perf_modules
  expansions:
    mongodb_setup: atlas-like-replica-query-stats.2023-09
    mongodb_setup_release: 2022-11
    infrastructure_provisioning: M60-like-replica.2023-09
    infrastructure_provisioning_release: 2023-09
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: al2023-arm64-compile
    client_compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-M60-like"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: tpcc
    - name: tpcc_majority
    - name: linkbench
    - name: linkbench2

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-shard-query-stats.arm.aws.2023-11
  display_name: PERF 3-Shard Cluster (QueryStats) ARM AWS 2023-11
  cron: "0 0 * * 4"  # 00:00 on Thursday
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: shard-query-stats
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: shard
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
  run_on:
    - "rhel70-perf-shard"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: mongos_workloads
    - name: tsbs_query_sharded
    - name: tsbs_query_finance_sharded
    - name: tsbs_query_sharded_balancer
    - name: tsbs_query_finance_sharded_balancer

- <<: *amazon2_x86_compile_variant_dependency
  name: perf-3-node-replSet-intel-query-stats.intel.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats) Intel AWS 2023-11
  cron: "0 0 * * 1,2,3,4,5,6"  # Everyday except Sunday at 00:00
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-query-stats-rate-limit
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica-intel.2023-11
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-x86-compile
    config_params_json: '{"v": 0, "featureFlagQueryStats": true}'
  run_on:
    - "rhel70-perf-replset"
  tasks: &3node-query-stats-tasks
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: crud_workloads_majority
    - name: smoke_test
    - name: bestbuy_agg
    - name: bestbuy_agg_merge_different_db
    - name: bestbuy_agg_merge_same_db
    - name: bestbuy_agg_merge_wordcount
    - name: bestbuy_query
    - name: tpcc_majority
    - name: linkbench
    - name: linkbench2
    - name: tsbs_load
    - name: tsbs_query
    - name: mixed_workloads_genny_rate_limited_high_value
    - name: load_test_high_value
    - name: majority_reads10_k_threads_high_value
    - name: large_indexed_ins_high_value
    - name: expressive_queries_high_value
    - name: time_series_sort_high_value

- &3node-query-stats-rate-limit
  <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-3-node-replSet-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats) ARM AWS 2023-11
  cron: "0 0 * * 1,2,3,4,5,6"  # Everyday except Sunday at 00:00
  modules: *perf_modules
  expansions: &3node-query-stats-rate-limit-expansions
    mongodb_setup_release: 2022-11
    mongodb_setup: replica-query-stats-rate-limit
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: replica
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
    config_params_json: '{"v": 0, "featureFlagQueryStats": true}'
  run_on:
    - "rhel70-perf-replset"
  tasks: *3node-query-stats-tasks

- <<: *3node-query-stats-rate-limit
  name: perf-3-node-replSet-limited-10-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats, Rate Limited with 10) ARM AWS 2023-11
  expansions:
    <<: *3node-query-stats-rate-limit-expansions
    config_params_json: '{"v": 0, "featureFlagQueryStats": true, "internalQueryStatsRateLimit": 10}'
  tasks: &3node-query-stats-rate-limit-tasks
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: bestbuy_agg
    - name: tpcc_majority
    - name: linkbench2
    - name: tsbs_query
    - name: mixed_workloads_genny_rate_limited_high_value
    - name: majority_reads10_k_threads_high_value
    - name: large_indexed_ins_high_value
    - name: expressive_queries_high_value
    - name: time_series_sort_high_value

- <<: *3node-query-stats-rate-limit
  name: perf-3-node-replSet-limited-20-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats, Rate Limited with 20) ARM AWS 2023-11
  expansions:
    <<: *3node-query-stats-rate-limit-expansions
    config_params_json: '{"v": 0, "featureFlagQueryStats": true, "internalQueryStatsRateLimit": 20}'
  tasks: *3node-query-stats-rate-limit-tasks

- <<: *3node-query-stats-rate-limit
  name: perf-3-node-replSet-limited-50-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats, Rate Limited with 50) ARM AWS 2023-11
  expansions:
    <<: *3node-query-stats-rate-limit-expansions
    config_params_json: '{"v": 0, "featureFlagQueryStats": true, "internalQueryStatsRateLimit": 50}'
  tasks: *3node-query-stats-rate-limit-tasks

- <<: *3node-query-stats-rate-limit
  name: perf-3-node-replSet-limited-1000-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats, Rate Limited with 1000) ARM AWS 2023-11
  expansions:
    <<: *3node-query-stats-rate-limit-expansions
    config_params_json: '{"v": 0, "featureFlagQueryStats": true, "internalQueryStatsRateLimit": 1000}'
  tasks: *3node-query-stats-rate-limit-tasks

- <<: *3node-query-stats-rate-limit
  name: perf-3-node-replSet-limited-10000-query-stats.arm.aws.2023-11
  display_name: PERF 3-Node ReplSet (QueryStats, Rate Limited with 10000) ARM AWS 2023-11
  expansions:
    <<: *3node-query-stats-rate-limit-expansions
    config_params_json: '{"v": 0, "featureFlagQueryStats": true, "internalQueryStatsRateLimit": 10000}'
  tasks: *3node-query-stats-rate-limit-tasks

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-standalone-query-stats.arm.aws.2023-11
  display_name: PERF Standalone (QueryStats) ARM AWS 2023-11
  cron: *linux-standalone-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: standalone-query-stats
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: single
    workload_setup: 2022-11
    platform: linux
    project_dir: *perf_project_dir
    authentication: enabled
    storageEngine: wiredTiger
    compile_variant: amazon2-arm64-compile
    config_params_json: '{"v": 0, "featureFlagQueryStats": true}'
  run_on:
    - "rhel70-perf-single"
  tasks:
    - *schedule_patch_auto_tasks_task
    - *schedule_variant_auto_tasks_task
    - name: ycsb.2023-09
    - name: ycsb_60GB.2023-09
    - name: ycsb_60GB.long.2023-09
    - name: crud_workloads_majority
    - name: tpcc
    - name: tpch_1_normalized
    - name: tpch_1_denormalized
    - name: tpch_10_normalized
    - name: tpch_10_denormalized

- <<: *amazon_linux2_arm64_compile_variant_dependency
  name: perf-mongo-perf-standalone-query-stats.arm.aws.2023-11
  display_name: PERF Mongo-Perf Standalone inMemory (QueryStats) ARM AWS 2023-11
  cron: *linux-microbench-cron
  modules: *perf_modules
  expansions:
    mongodb_setup_release: 2022-11
    mongodb_setup: mongo-perf-standalone-query-stats
    infrastructure_provisioning_release: 2023-09
    infrastructure_provisioning: workload_client_mongod_combined.2023-01
    workload_setup: 2022-11
    use_scons_cache: true
    platform: linux
    canaries: none
    storageEngine: inMemory
    project_dir: *perf_project_dir
    compile_variant: amazon2-arm64-compile
  run_on:
  - "rhel70-perf-microbenchmarks"
  tasks:
    - name: big_collection
    - name: genny_scale_InsertRemove
    - name: genny_execution_UserAcquisition
    - name: aggregation_read_commands
    - name: aggregation_read_commands_large_dataset
    - name: agg-query-comparison_read_commands
    - name: query_read_commands
    - name: query_read_commands_large_dataset
    - name: views-aggregation
    - name: views-query
    - name: where_read_commands
    - name: update_read_commands
    - name: insert_read_commands
    - name: wildcard-index-read_read_commands
    - name: wildcard-index-write_read_commands
    - name: geo_read_commands
    - name: misc_read_commands
    - name: singleThreaded_read_commands
    - name: pipeline-updates
    - name: javascript
    - name: compound_wildcard_index_write_commands
    - name: compound_wildcard_index_read_commands
    - name: tie-breaking-heuristics
